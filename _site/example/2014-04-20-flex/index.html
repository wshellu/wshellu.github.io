<!DOCTYPE html>
<html>

<head>
    <title>Flex</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="keywords" content="Flex, front-end, Flex ActionScript script, whsellu" />
    <meta name="description" content="Flex, front-end, Flex ActionScript script, C Developer" />
    <meta name="theme-color" content="#2CA6CB"/>
    <link rel="shortcut icon" type="image/x-icon" media="screen" href="http://wshellu.github.io/favicon.ico" />
    <link rel="canonical" href="http://wshellu.github.io/example/2014-04-20-flex/" />
    <link rel="alternate" type="application/rss+xml" title="whsellu" href="http://wshellu.github.io/feed.xml"  />

    <link rel="stylesheet" type="text/css" href="http://apps.bdimg.com/libs/bootstrap/3.3.0/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="http://wshellu.github.io/static/octicons/octicons.css" />
    <link rel="stylesheet" type="text/css" href="http://wshellu.github.io/static/css/style.css" />

    <script type="text/javascript" src="http://apps.bdimg.com/libs/jquery/1.11.3/jquery.js"></script>
    <script type="text/javascript" src="http://apps.bdimg.com/libs/bootstrap/3.3.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="http://wshellu.github.io/static/js/script.js"></script>
</head>


<body>
<div class="main">

    
    
    <header>
        <nav class="navbar navbar-tiffany rectangle" role="navigation">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="http://wshellu.github.io/">whsellu</a>
                    <p class="navbar-text">C Developer</p>
                </div>
                <div class="collapse navbar-collapse">
                    <ul class="nav navbar-nav navbar-right">
                        
                        <li>
                        <a href="http://wshellu.github.io/" class="word-keep"><span class="octicon octicon-book"></span></span>&nbsp;&nbsp;Blog</a>
                        </li>
                        
                        
                        <li>
                            <a href="http://wshellu.github.io/archive/" class="word-keep"><span class="octicon octicon-repo"></span>&nbsp;&nbsp;Archive</a>
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <li>
                            <a href="http://wshellu.github.io/category/" class="word-keep"><span class="octicon octicon-list-unordered"></span>&nbsp;&nbsp;Category</a>
                        </li>
                        
                        
                        
                        <li>
                            <a href="http://wshellu.github.io/tags/" class="word-keep"><span class="octicon octicon-tag"></span>&nbsp;&nbsp;Tag</a>
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <li><a href="#stq=" class="search-button"><span class="octicon octicon-search"></span></a></li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>



    <div class="container">
        <link rel="stylesheet" type="text/css" href="http://wshellu.github.io/static/css/highlight.css" />
<link rel="stylesheet" type="text/css" href="http://wshellu.github.io/static/css/post.css" />
<script type="text/javascript" src="http://wshellu.github.io/static/js/post.js"></script>
<script type="text/javascript" src="http://wshellu.github.io/static/js/toc.js"></script>
<div class="row">
    <div class="content col-lg-9">
        <div class="sheet post">
          <header>
            <h2>Flex</h2>
            <p class="post-meta">
                <span class="octicon octicon-clock"></span> 
            </p>
            <p class="post-tag">
                <span><a href="http://wshellu.github.io/category/#front-end"><span class="octicon octicon-list-unordered"></span>&nbsp;front-end</a></span>
                <span>
                    <a class="word-keep" href="http://wshellu.github.io/tags/#Flex ActionScript script"><span class="octicon octicon-tag"></span>&nbsp;Flex ActionScript script</a>
                    
                </span>
            </p>
          </header>
          <hr class="boundary">
          <article>
            <div class="toc"></div>

<p>#产品</p>

<ol>
  <li>
    <p>Adobe® Flex™ SDK</p>
  </li>
  <li>
    <p>Adobe® Flex™ Builder™</p>
  </li>
  <li>
    <p>Adobe® Flex™ Data Services</p>
  </li>
  <li>
    <p>Adobe® Flex™ Charting</p>
  </li>
</ol>

<p>#Flex基础</p>

<p>##应用程序模型</p>

<p>用容器（如Box）控件（如Button）来描述用户的操作界面</p>

<p>##MVC模型</p>

<ol>
  <li>
    <p>模型/Model 组件封装了数据和与数据相关的行为。</p>
  </li>
  <li>
    <p>视图/View 组件定义了应用程序的用户界面。</p>
  </li>
  <li>
    <p>控制器/Controller 组件则负责处理程序中的数据连接。</p>
  </li>
</ol>

<p>##Flex 编程模型</p>

<p>Flex 包含了<strong>Flex 类库</strong>、<strong>MXML</strong> 和<strong>ActionScript</strong> 编程语言，以及<strong>Flex 编译器</strong>和<strong>调试器</strong>。</p>

<blockquote>
  <p>MXML 和 ActionScript 编程语言都提供了访问Flex 类库的能力。</p>
</blockquote>

<p>通常的做法是：使用MXML 去定义用户界面的元素，使用ActionScript 去定义客户端的逻辑并进行控制。</p>

<p>Flex 类库包括了<strong>Flex 组件</strong>、<strong>管理器</strong>和<strong>行为</strong>。</p>

<p>##Flex 元素</p>

<ul>
  <li>
    <p>Flex framework</p>
  </li>
  <li>
    <p>MXML</p>
  </li>
  <li>
    <p>ActionScript 3.0</p>
  </li>
  <li>
    <p>CSS</p>
  </li>
  <li>
    <p>图形资源</p>
  </li>
  <li>
    <p>数据</p>
  </li>
</ul>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;mx:Application</span> <span class="na">xmlns:mx=</span><span class="s">"http://www.adobe.com/2006/mxml"</span> <span class="na">layout=</span><span class="s">"absolute"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;mx:Panel&gt;</span>
        <span class="nt">&lt;mx:TextArea</span> <span class="na">text=</span><span class="s">"Say hello to Flex!"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;mx:Button</span> <span class="na">label=</span><span class="s">"Close"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/mx:Panel&gt;</span>
<span class="nt">&lt;/mx:Application&gt;</span>

</code></pre>
</div>

<p>##发布方式</p>

<ol>
  <li>
    <p>客户端模式，即应用程序只运行在客户端上而不需要服务器资源。</p>
  </li>
  <li>
    <p>使用简单的RPC 访问服务器数据，即使用HTTPService（HTTP GET 或POST 请求）和WebService（通过使用SOAP）。</p>
  </li>
  <li>
    <p>Flex Data Services 模式，可以提供更为高级的特性，如数据同步、安全增强等等。</p>
  </li>
</ol>

<p>#界面布局</p>

<p>样式</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;mx:Style&gt;</span>
     {
        fontSize: 36px;
        fontWeight: bold;
     }
<span class="nt">&lt;/mx:Style&gt;</span>

</code></pre>
</div>
<p>外部样式</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;mx:Style</span> <span class="na">source=</span><span class="s">"styles.css"</span><span class="nt">/&gt;</span>

</code></pre>
</div>

<p>##控制应用程序的外观</p>

<ol>
  <li>
    <p>大小/Sizes，即组件或应用程序的高度和宽度。</p>
  </li>
  <li>
    <p>样式/Styles，即一组特性，如字体、排列方式、颜
色等。它们都是通过层叠样式（ CSS）来进行设置的。</p>
  </li>
  <li>
    <p>皮肤/Skins，即可以进行改变的组件视觉元素。</p>
  </li>
  <li>
    <p>行为/Behaviors，即Flex 组件在视觉或听觉效果方面的变化。</p>
  </li>
  <li>
    <p>视图状态/View state 可以让你通过修改它的基础内容，来改变组件或程序的内容和外观。</p>
  </li>
  <li>
    <p>变换/Transitions 可以让你定义屏幕上发生改变的视图状态。</p>
  </li>
</ol>

<p>##受约束的布局</p>

<p>受约束的布局可以确保用户界面中的组件在程序窗</p>

<p>口大小发生变化时，也能自动地作出调节。备注：可以通过使用嵌套的布局容器/nested layout container 来实现相同的目的</p>

<p>创建受约束的布局，你必须将容器的布局属性设置为绝对方式（ <code class="highlighter-rouge">layout="absolute"</code>）备注：帆布容器/canvas container 并不需要进行layout=”absolute”的属性设置，因为它默认是绝对布局方式。</p>

<p>在Flex 中，所有的约束都是被设置为与<strong>容器</strong>的相对距离，它们不可能被设置为相对于其它控件</p>

<p><strong>控件</strong></p>

<p>ComboBox，List，HorizontalList。</p>

<p>#事件与行为</p>

<p>外部ActionScript</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;mx:Script</span> <span class="na">source=</span><span class="s">"myFunctions.as"</span> <span class="nt">/&gt;</span>

</code></pre>
</div>

<p>被事件触发的行为</p>

<p>mxml中的组件被赋予id后，在as中将可以直接作为对象进就行操作，如例子中的<code class="highlighter-rouge">vBox</code></p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code>var locales:ArrayCollection = new ArrayCollection([{label:"en_us", data:"en_us"},{label:"zh_cn", data:"zh_cn"}]);

var child:ComboBox = new ComboBox();
child.dataProvider=locales;
vBox.addChild(child);

</code></pre>
</div>

<p>也可以在as中为事件绑定行为</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code>//change事件绑定
localeComboBox.addEventListener(ListEvent.CHANGE,localeComboxChangeHandler);

</code></pre>
</div>

<p>##多态页面</p>

<p>用ViewStack 组件、创建单独的MXML 文件、或者使用视图状态</p>

<p>##创建行为</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;mx:Glow</span> <span class="na">id=</span><span class="s">"buttonGlow"</span> <span class="na">color=</span><span class="s">"0x99FF66"</span> <span class="na">alphaFrom=</span><span class="s">"1.0"</span> <span class="na">alphaTo=</span><span class="s">"0.3"</span> <span class="na">duration=</span><span class="s">"1500"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;mx:Button</span> <span class="na">x=</span><span class="s">"40"</span> <span class="na">y=</span><span class="s">"60"</span> <span class="na">label=</span><span class="s">"View"</span> <span class="na">id=</span><span class="s">"myButton"</span> <span class="err">mo</span>
<span class="na">useUpEffect=</span><span class="s">"{buttonGlow}"</span> <span class="nt">/&gt;</span>

</code></pre>
</div>

<p>#连接数据</p>

<p>数据源，url获取xml类型数据</p>

<p>flex 不直接连接数据库，而是用数据服务组件获取xml数据</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;mx:HTTPService</span> <span class="na">id=</span><span class="s">"simpleData"</span> <span class="na">url=</span><span class="s">"..."</span><span class="nt">/&gt;</span>

</code></pre>
</div>

<p>数据绑定，并非简单的引用，dataProvider与simpleData.lastResult.products.items是同步变化的</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;mx:DataGrid</span> <span class="na">dataProvider=</span><span class="s">"{simpleData.lastResult.products.items}"</span> <span class="nt">&gt;</span>
            <span class="nt">&lt;mx:columns&gt;</span>
                <span class="nt">&lt;mx:DataGridColumn</span> <span class="na">headerText=</span><span class="s">"resources"</span> <span class="na">dataField=</span><span class="s">"resources"</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/mx:columns&gt;</span>
        <span class="nt">&lt;/mx:DataGrid&gt;</span>

</code></pre>
</div>

<p>事件绑定</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;mx:Button</span> <span class="na">label=</span><span class="s">"load"</span> <span class="na">click=</span><span class="s">"simpleData.send();"</span><span class="nt">/&gt;</span>

</code></pre>
</div>

<p>##连接数据服务器</p>

<ol>
  <li>
    <p>WebService 提供对使用SOAP 的web 服务器的访问。</p>
  </li>
  <li>
    <p>HTTPService 提供对返回数据的HTTP URLs 的访问。</p>
  </li>
  <li>
    <p>RemoteObject 通过使用AML 协议提供对Java 对象（Java Beans、EJBs、POJOs）的访问。该选项目前仅适用于Flex Data Services 或Macromedia ColdFusion MX 7.0.2.</p>
  </li>
</ol>

<p>##安全性</p>

<ol>
  <li>
    <p>swf与数据源必须同域</p>
  </li>
  <li>
    <p>可以使用代理访问远程数据源，但是swf必须与代理服务器同域</p>
  </li>
  <li>
    <p>安装<code class="highlighter-rouge">crossdomain.xml</code>（跨域策略/cross-domain policy）文件在数据源的宿主Web 服务器上。
crossdomain.xml 文件允许位于其它域中的SWF 文件对数据源的访问。</p>
  </li>
</ol>

<p>#图表组件</p>

<ul>
  <li>
    <p>区域形图表/Area charts</p>
  </li>
  <li>
    <p>气泡形图表/Bubble charts</p>
  </li>
  <li>
    <p>烛形图表/Candlestick charts</p>
  </li>
  <li>
    <p>柱形图表/Column charts</p>
  </li>
  <li>
    <p>高低开合形图表/HighLowOpenClose charts</p>
  </li>
  <li>
    <p>线形图表/Line charts</p>
  </li>
  <li>
    <p>饼形图表/Pie charts</p>
  </li>
  <li>
    <p>标绘形图表/Plot charts</p>
  </li>
  <li>
    <p>扩展CartesianChart 控件来创建定制的图表</p>
  </li>
</ul>

<blockquote>
  <p>使用<code class="highlighter-rouge">dataProvider</code> 属性定义图表的数据</p>
</blockquote>

<p>#MXML</p>

<p>MXM 相关的技术标准有</p>

<ol>
  <li>
    <p>XML 标准。XML 文档使用标签去决定结构化信息的内容，以及它们之间的关系。</p>
  </li>
  <li>
    <p>事件模型标准。Flex 事件模型是文档对象模型/Document Object Model （DOM）第三级事件的一个子集，该模型是由World Wide Web Consortium（W3C）起草制定。</p>
  </li>
  <li>
    <p>Web 服务标准Flex 提供与服务器交互的MXML 标签，遵循了Web 服务描述语言/Web Services
Description Language（WSDL）的规则。具体包括了简单对象访问协议/Simple Object Access Pr
otocol（SOAP）和超文本传送协议/Hypertext Transfer Protocol（HTTP）。</p>
  </li>
  <li>
    <p>Java 标准</p>
  </li>
</ol>

<p>Flex 提供了与服务器端Java 对象交互的MXML 标签，包括plain old Java objects（POJOs），Java</p>

<p>Beans 和企业级/Enterprise JavaBeans（EJBs）。</p>

<ol>
  <li>HTTP 标准</li>
</ol>

<p>Flex 提供了相应的MXML 标签去支持标准的HTTP GET 和POST 请求，以及对HTTP 返回数据的处理。</p>

<ol>
  <li>图形标准</li>
</ol>

<p>Flex 还提供了相应的MXML 标签去使用JPEG，GIF 和PNG 图象。Flex 还能够将SWF 文件和Scala
ble Vector Graphics（SVG）文件导入到应用程序中。</p>

<ol>
  <li>层叠样式表标准MXML 样式的定义和使用遵循了W3C Cascading Style Sheets （CSS）标准。</li>
</ol>

<p>#ActionScript</p>

<p>ActionScript 3.0 的特性完全实现了ECMAScript for XML (E4X)。
在flex中使用ActionScript</p>

<ol>
  <li>
    <p>在<code class="highlighter-rouge">&lt;mx:Script&gt;</code>标签中插入ActionScript 代码块。</p>
  </li>
  <li>
    <p>调用存储在<strong>system_classes</strong> 目录结构中的全局ActionScript 功能函数。</p>
  </li>
  <li>
    <p>引用**user_classes **中的外部类和包来处理更为复杂的任务。</p>
  </li>
  <li>
    <p>使用标准的Flex 组件。</p>
  </li>
  <li>
    <p>使用ActionScript 类扩展已有的组件。</p>
  </li>
  <li>
    <p>使用ActionScript 创建新的组件。</p>
  </li>
  <li>
    <p>在Flash 创建环境中创建新的组件（ SWC 文件）。</p>
  </li>
</ol>

<p>#XML</p>

<p>##创建xml对象</p>

<ul>
  <li>字面量方式，AS可以自动识别，如果加上引号就不是XML类型而是String类型了</li>
</ul>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code>var textXmlObj:XML = <span class="nt">&lt;test&gt;&lt;element&gt;</span>text<span class="nt">&lt;/element&gt;&lt;/test&gt;</span>;  

</code></pre>
</div>

<ul>
  <li>XML字面量中可以加入动态内容</li>
</ul>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code>var text_node:String = "text";  
var textXmlObj:XML = <span class="nt">&lt;test&gt;&lt;element&gt;</span>{text_node}<span class="nt">&lt;/element&gt;&lt;/test&gt;</span>;  

</code></pre>
</div>

<ul>
  <li>通过XML类创建实例</li>
</ul>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code>var myText:String = "text";  
var str:String = "<span class="nt">&lt;test&gt;&lt;element&gt;</span>"+ myText + "<span class="nt">&lt;/element&gt;&lt;/test&gt;</span>";  
var textXmlObj:XML = new XML(str);  

</code></pre>
</div>

<ul>
  <li>从外部加载XML对象</li>
</ul>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code> <span class="nt">&lt;mx:HTTPService</span> <span class="na">id=</span><span class="s">"simpleData"</span> <span class="na">url=</span><span class="s">"simpleData.xml"</span> <span class="na">useProxy=</span><span class="s">"false"</span> <span class="na">result=</span><span class="s">"test(event);"</span><span class="nt">/&gt;</span> 

</code></pre>
</div>

<p>##处理XML对象</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;items&gt;</span>
	<span class="nt">&lt;item</span> <span class="na">index=</span><span class="s">"0"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;name&gt;</span>Mobile Phone<span class="nt">&lt;/name&gt;</span>
		<span class="nt">&lt;price&gt;</span>$199<span class="nt">&lt;/price&gt;</span>
	<span class="nt">&lt;/item&gt;</span>
	<span class="nt">&lt;item</span> <span class="na">index=</span><span class="s">"1"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;name&gt;</span>Car Charger<span class="nt">&lt;/name&gt;</span>
		<span class="nt">&lt;price&gt;</span>$34<span class="nt">&lt;/price&gt;</span>
	<span class="nt">&lt;/item&gt;</span>
<span class="nt">&lt;/items&gt;</span>

</code></pre>
</div>

<p>使用<strong><code class="highlighter-rouge">E4X</code></strong>简化对XML的操作</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code> <span class="nt">&lt;mx:HTTPService</span> <span class="na">id=</span><span class="s">"simpleData"</span> <span class="na">url=</span><span class="s">"simpleData.xml"</span> <span class="na">useProxy=</span><span class="s">"false"</span> <span class="na">result=</span><span class="s">"test(event);"</span> <span class="na">resultFormat=</span><span class="s">"e4x"</span><span class="nt">/&gt;</span>

</code></pre>
</div>

<p>###查询</p>

<p>使用<code class="highlighter-rouge">.</code>操作符查询节点</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code>simpleData.lastResult.item

</code></pre>
</div>
<p>使用<code class="highlighter-rouge">[]</code>访问指定索引的节点，<strong>将无法检测到数据变化</strong>，根节点被忽略</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code>simpleData.lastResult.item[0]

</code></pre>
</div>
<p>使用<code class="highlighter-rouge">..</code>访问所有指定名称的节点，忽略上下级关系</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code>simpleData.lastResult..name

</code></pre>
</div>
<p>使用<code class="highlighter-rouge">@</code>访问节点属性</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code>simpleData.lastResult.item[0].@index

</code></pre>
</div>
<p>过滤节点(<code class="highlighter-rouge">&lt;</code>与<code class="highlighter-rouge">&gt;</code>无法在mxml中使用，需要转义)</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code>simpleData.lastResult.item.(price==34)

</code></pre>
</div>
<p>过滤属性</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code>simpleData.lastResult.item.(@index==0)

</code></pre>
</div>
<p>修改获取的数据（不改变xml源对象）</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code>simpleData.lastResult.item.(price=998)}

</code></pre>
</div>
<p>HttpService对象在加载外部XML后会自动把它转换成ArrayCollection对象</p>

<p>如果需要属性结构如（Tree组件），需要在HTTPService对象中加上resultFormat=”e4x”以XML的格式读取进来而不要转换为ArrayCollection</p>

<p>###修改</p>

<blockquote>
  <p>如果绑定的xml数据发生的变化，如何将变化传递到引用？目前发现似乎是自动的，有待研究。</p>
</blockquote>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code>var myxml:XML = <span class="nt">&lt;books&gt;</span>
     <span class="nt">&lt;book</span> <span class="na">name=</span><span class="s">"flex tutorial"</span><span class="nt">&gt;</span>
         <span class="nt">&lt;price&gt;</span>30<span class="nt">&lt;/price&gt;</span>
         <span class="nt">&lt;author&gt;</span>adobe<span class="nt">&lt;/author&gt;</span>
     <span class="nt">&lt;/book&gt;</span>
 <span class="nt">&lt;/books&gt;</span>

</code></pre>
</div>
<p>添加节点，insert指定子节点位置插入，append添加到子节点末尾，prepend插入到子节点开头</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code>myxml.insertChildAfter(myxml.book[0],<span class="nt">&lt;newbook</span> <span class="na">name=</span><span class="s">"After"</span><span class="nt">/&gt;</span>);
myxml.insertChildBefore(myxml.book[0],<span class="nt">&lt;newbook</span> <span class="na">name=</span><span class="s">"Before"</span><span class="nt">/&gt;</span>);
myxml.appendChild(<span class="nt">&lt;newbook</span> <span class="na">name=</span><span class="s">"Append"</span><span class="nt">/&gt;</span>);
myxml.prependChild(<span class="nt">&lt;newbook</span> <span class="na">name=</span><span class="s">"Prepend"</span><span class="nt">/&gt;</span>);   

</code></pre>
</div>
<p>添加属性</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code>myxml.book[0].@date="2008";

</code></pre>
</div>
<p>修改xml对象，此处增加<code class="highlighter-rouge">&lt;author&gt;</code>标签content为奥多比</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code>myxml.book[0].author="奥多比";

</code></pre>
</div>
<p>删除节点，属性，content</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code>delete myxml.book[0].@name;
delete myxml.book[0].author;
delete myxml.book[0].price.text()[0];

</code></pre>
</div>

<p>#备忘</p>

<p>IDEA 编译出错 <strong>java.net.SocketTimeoutException: Accept timed out</strong>
&gt;<a href="http://stackoverflow.com/questions/11016571/intellij-idea-11-flex-compilation-issue">Stack Overflow</a>
&gt;
&gt;1. Go to <strong>Settings</strong> &gt; <strong>Compiler</strong> &gt; <strong>Flex Compiler</strong>
&gt;
&gt;2. Choose <strong>Mxmlc/compx</strong> instead of the default <strong>Built-in compiler shell</strong>
&gt;
&gt;3. Compile your application</p>

<p>#整合SpringMVC</p>

<p>Flex要想与Spring进行配合使用，需要一个附加的组件BlazeDS。BlazeDS可以将Flex前端的通信内容（amf 格式 Action Message format，一种flex定义的通信规则）转换为java的相关类和对象。</p>

<p>请求处理的简单流程是，flex客户端向服务器发送Request请求，服务器根据Web.xml中的映射，找到Spring配置文档中与flex相关的配置，这个配置就是<code class="highlighter-rouge">MessageBroker</code>，MessageBroker是Spring容器根据flex的<code class="highlighter-rouge">services-config.xml</code>文件生成的，在services-config.xml中指定了消息通道，Spring将请求交给这个通道（一般是默认通道），通道根据<code class="highlighter-rouge">remoting-config.xml</code>中配置的remoting-service和Adapter将flex的amf转换为java的实例信息。如果需要安全或者消息订阅（jms）还需要提供<code class="highlighter-rouge">messaging-config.xml</code>和<code class="highlighter-rouge">proxy-config.xml</code>配置文件。</p>

<p>结合使用Spring和BlazeDS必须对MessageBroker进行配置。从flex客户端发来的Http 消息（messages）通过Spring的DispatcherServlet（在web.xml中配置）传递给Spring管理的MessageBroker（在Spring的配置文档中指明）。如果使用Spring管理的MessageBroker就不必配置BlazeDS的<code class="highlighter-rouge">MessageBrokerServlet</code>（在web.xml文档中指明）了。</p>

<p>##依赖</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code>  <span class="nt">&lt;properties&gt;</span>
    <span class="nt">&lt;spring.version&gt;</span>3.0.1.RELEASE<span class="nt">&lt;/spring.version&gt;</span>
    <span class="nt">&lt;flex.version&gt;</span>4.6<span class="nt">&lt;/flex.version&gt;</span>
  <span class="nt">&lt;/properties&gt;</span>

  <span class="nt">&lt;dependencies&gt;</span>
      <span class="nt">&lt;dependency&gt;</span>
          <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
          <span class="nt">&lt;artifactId&gt;</span>spring-webmvc<span class="nt">&lt;/artifactId&gt;</span>
          <span class="nt">&lt;version&gt;</span>${spring.version}<span class="nt">&lt;/version&gt;</span>
      <span class="nt">&lt;/dependency&gt;</span>
      <span class="nt">&lt;dependency&gt;</span>
          <span class="nt">&lt;groupId&gt;</span>org.springframework.flex<span class="nt">&lt;/groupId&gt;</span>
          <span class="nt">&lt;artifactId&gt;</span>org.springframework.flex<span class="nt">&lt;/artifactId&gt;</span>
          <span class="nt">&lt;version&gt;</span>1.0.3.RELEASE<span class="nt">&lt;/version&gt;</span>
      <span class="nt">&lt;/dependency&gt;</span>

      <span class="c">&lt;!-- flex library --&gt;</span>

      <span class="nt">&lt;dependency&gt;</span>
          <span class="nt">&lt;groupId&gt;</span>com.adobe.flex<span class="nt">&lt;/groupId&gt;</span>
          <span class="nt">&lt;artifactId&gt;</span>messaging-common<span class="nt">&lt;/artifactId&gt;</span>
          <span class="nt">&lt;version&gt;</span>${flex.version}<span class="nt">&lt;/version&gt;</span>
      <span class="nt">&lt;/dependency&gt;</span>
      <span class="nt">&lt;dependency&gt;</span>
          <span class="nt">&lt;groupId&gt;</span>com.adobe.flex<span class="nt">&lt;/groupId&gt;</span>
          <span class="nt">&lt;artifactId&gt;</span>messaging-core<span class="nt">&lt;/artifactId&gt;</span>
          <span class="nt">&lt;version&gt;</span>${flex.version}<span class="nt">&lt;/version&gt;</span>
      <span class="nt">&lt;/dependency&gt;</span>
      <span class="nt">&lt;dependency&gt;</span>
          <span class="nt">&lt;groupId&gt;</span>com.adobe.flex<span class="nt">&lt;/groupId&gt;</span>
          <span class="nt">&lt;artifactId&gt;</span>messaging-remoting<span class="nt">&lt;/artifactId&gt;</span>
          <span class="nt">&lt;version&gt;</span>${flex.version}<span class="nt">&lt;/version&gt;</span>
      <span class="nt">&lt;/dependency&gt;</span>
      <span class="nt">&lt;dependency&gt;</span>
          <span class="nt">&lt;groupId&gt;</span>backport-util-concurrent<span class="nt">&lt;/groupId&gt;</span>
          <span class="nt">&lt;artifactId&gt;</span>backport-util-concurrent<span class="nt">&lt;/artifactId&gt;</span>
          <span class="nt">&lt;version&gt;</span>3.1<span class="nt">&lt;/version&gt;</span>
      <span class="nt">&lt;/dependency&gt;</span>
      <span class="nt">&lt;dependency&gt;</span>
          <span class="nt">&lt;groupId&gt;</span>cglib<span class="nt">&lt;/groupId&gt;</span>
          <span class="nt">&lt;artifactId&gt;</span>cglib<span class="nt">&lt;/artifactId&gt;</span>
          <span class="nt">&lt;version&gt;</span>2.2.2<span class="nt">&lt;/version&gt;</span>
      <span class="nt">&lt;/dependency&gt;</span>
  <span class="err">&lt;</span>/dependencies

</code></pre>
</div>

<p>##配置web.xml</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;servlet&gt;</span>
    <span class="nt">&lt;servlet-name&gt;</span>Spring MVC Dispatcher Servlet<span class="nt">&lt;/servlet-name&gt;</span>
    <span class="nt">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="nt">&lt;/servlet-class&gt;</span>
    <span class="nt">&lt;init-param&gt;</span>
        <span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
        <span class="nt">&lt;param-value&gt;</span>
            classpath:applicationContext.xml
        <span class="nt">&lt;/param-value&gt;</span>
    <span class="nt">&lt;/init-param&gt;</span>
    <span class="nt">&lt;load-on-startup&gt;</span>1<span class="nt">&lt;/load-on-startup&gt;</span>
<span class="nt">&lt;/servlet&gt;</span>

<span class="c">&lt;!-- MessageBroker Servlet flex mapping--&gt;</span>
<span class="nt">&lt;servlet-mapping&gt;</span>
    <span class="nt">&lt;servlet-name&gt;</span>Spring MVC Dispatcher Servlet<span class="nt">&lt;/servlet-name&gt;</span>
    <span class="nt">&lt;url-pattern&gt;</span>/messagebroker/*<span class="nt">&lt;/url-pattern&gt;</span>
<span class="nt">&lt;/servlet-mapping&gt;</span>

</code></pre>
</div>

<p>Flex通过<code class="highlighter-rouge">AMF</code>通道的形式进行通信的，所谓的AMF通道就是指一种编码形式。MessageBroker可以将Flex格式的请求转换成具体的java的调用，并将反馈回的内容（response）编码成Flex能够识别的对象（amf）。</p>

<p>##Srping容器</p>

<p>使用了默认位置的配置文件</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/beans"</span>
       <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="na">xmlns:flex=</span><span class="s">"http://www.springframework.org/schema/flex"</span>
       <span class="na">xmlns:context=</span><span class="s">"http://www.springframework.org/schema/context"</span>
       <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.springframework.org/schema/beans</span> <span class="err">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
       <span class="err">http://www.springframework.org/schema/context</span> <span class="err">http://www.springframework.org/schema/context/spring-context.xsd</span>
       <span class="err">http://www.springframework.org/schema/flex</span> <span class="err">http://www.springframework.org/schema/flex/spring-flex-1.0.xsd"</span><span class="nt">&gt;</span>

        <span class="c">&lt;!-- 使用默认位置的配置文件/WEB-INF/flex/services-config.xml--&gt;</span>
       <span class="nt">&lt;flex:message-broker/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>
<span class="nt">&lt;/beans&gt;</span>

</code></pre>
</div>

<p>##通道</p>

<p>在BlazeDS的配置文件services-config.xml中定义的通道必须与相应的映射相对应。</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;channels&gt;</span>
	<span class="nt">&lt;channel-definition</span> <span class="na">id=</span><span class="s">"my-amf"</span> <span class="na">class=</span><span class="s">"mx.messaging.channels.AMFChannel"</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- {context.root}之后的messagebroker必须与ServletMapping相同 --&gt;</span>
    <span class="nt">&lt;endpoint</span> <span class="na">url=</span><span class="s">"http://{server.name}:{server.port}/{context.root}/messagebroker/amf"</span>
              <span class="na">class=</span><span class="s">"flex.messaging.endpoints.AMFEndpoint"</span><span class="nt">/&gt;</span>
	<span class="nt">&lt;/channel-definition&gt;</span>
<span class="nt">&lt;/channels&gt;</span>

</code></pre>
</div>

<p>##配置远程服务</p>

<p>这里有列举了两种发布方式，任选一种即可。</p>

<p>①创建使用注解发布的服务</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">top</span><span class="o">.</span><span class="na">rainynight</span><span class="o">.</span><span class="na">flex2spring</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.flex.remoting.RemotingDestination</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.flex.remoting.RemotingInclude</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="o">;</span>

<span class="nd">@Component</span>
<span class="nd">@RemotingDestination</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AnnotationRPC</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="n">read</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"annotation works"</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>

</code></pre>
</div>
<p>②创建使用xml发布的服务</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">top</span><span class="o">.</span><span class="na">rainynight</span><span class="o">.</span><span class="na">flex2spring</span><span class="o">;</span>

<span class="cm">/**
 * Created by sllx on 2015-03-16.
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">XmlConfRPC</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="n">read</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"xml works"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre>
</div>
<p>发布配置发布方式任选一种即可</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">"top"</span><span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"xmlConfRPC"</span> <span class="na">class=</span><span class="s">"top.rainynight.flex2spring.XmlConfRPC"</span><span class="nt">&gt;</span>
 <span class="nt">&lt;flex:remoting-destination/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

</code></pre>
</div>

<p>##flex使用默认channel
flex配置编译参数</p>

<div class="highlighter-rouge"><pre class="highlight"><code>-services "pathToWebappRoot/WEB-INF/flex/services-config.xml" -locale en_US

</code></pre>
</div>

<p>##测试</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;s:Application</span> <span class="na">xmlns:fx=</span><span class="s">"http://ns.adobe.com/mxml/2009"</span> 
			   <span class="na">xmlns:s=</span><span class="s">"library://ns.adobe.com/flex/spark"</span> 
			   <span class="na">xmlns:mx=</span><span class="s">"library://ns.adobe.com/flex/mx"</span> <span class="na">minWidth=</span><span class="s">"955"</span> <span class="na">minHeight=</span><span class="s">"600"</span> <span class="na">applicationComplete=</span><span class="s">"applicationCompleteHandler(event)"</span><span class="nt">&gt;</span>
	<span class="nt">&lt;fx:Script&gt;</span>
		<span class="cp">&lt;![CDATA[
			import mx.controls.Alert;
			import mx.events.FlexEvent;
			import mx.messaging.events.MessageAckEvent;
			import mx.rpc.events.FaultEvent;
			import mx.rpc.events.ResultEvent;
			
			
			protected function resultHandler(event:ResultEvent):void
			{
				Alert.show(event.result.toString(),"result");
			}
			
			protected function faultHandler(event:FaultEvent):void
			{
				Alert.show(event.message.toString() ,"error");
			}
			
			protected function applicationCompleteHandler(event:FlexEvent):void
			{
				ro.read("1");
			}
			
		]]&gt;</span>
	<span class="nt">&lt;/fx:Script&gt;</span>
	<span class="nt">&lt;fx:Declarations&gt;</span>
		<span class="nt">&lt;s:RemoteObject</span> <span class="na">destination=</span><span class="s">"annotationRPC"</span> <span class="na">id=</span><span class="s">"ro"</span> <span class="na">result=</span><span class="s">"resultHandler(event)"</span> <span class="na">fault=</span><span class="s">"faultHandler(event)"</span> <span class="nt">/&gt;</span>
	<span class="nt">&lt;/fx:Declarations&gt;</span>
<span class="nt">&lt;/s:Application&gt;</span>


</code></pre>
</div>

          </article>
          <hr class="boundary">
          <div id="post-share" class="bdsharebuttonbox">
              <a href="#" class="bds_more" data-cmd="more"></a>
              <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
              <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a>
              <a href="#" class="bds_douban" data-cmd="douban" title="分享到豆瓣网"></a>
              <a href="#" class="bds_fbook" data-cmd="fbook" title="分享到Facebook"></a>
              <a href="#" class="bds_copy" data-cmd="copy" title="分享到复制网址"></a>
          </div>
        </div>
        <div class="pad-min"></div>
        <div id="post-comment" class="sheet post">
            <div id="disqus_thread"></div>
        </div>
    </div>
    <div class="content-navigation col-lg-3">
      <div class="shadow-bottom-center" >
        <div class="content-navigation-toc">
            <div class="content-navigation-header">
                <span class="octicon octicon-list-unordered"></span>&nbsp;Toc
            </div>
            <div class="content-navigation-list toc"></div>
        </div>
        <div class="content-navigation-tag">
            <div class="content-navigation-header">
                <span class="octicon octicon-list-unordered"></span>&nbsp;Tags
            </div>
            <div class="content-navigation-list">
                <ul>
                    
                    <li>
                        <a href="http://wshellu.github.io/tags#Flex ActionScript script"><span class="octicon octicon-tag"></span>&nbsp;Flex ActionScript script</a>
                    </li>
                    
                </ul>
            </div>
        </div>
        <div class="content-navigation-related">
            <div class="content-navigation-header">
                <span class="octicon octicon-list-unordered"></span>&nbsp;Related
            </div>
            <div class="content-navigation-list">
                <ul>
                    

                    

                    
                </ul>
            </div>
        </div>
      </div>
    </div>
</div>
    </div>

    <div class="page-scrollTop" data-toggle="tooltip" data-placement="top" title="Top">
        <a href="javascript:void(0);">
            <div class="arrow"></div>
            <div class="stick"></div>
        </a>
    </div>
</div>

    <footer  class="footnote footnote-tiffany">
        <div class="container">
                <a class="foot-item" href="mailto:wshell84@gmail.com" target="_blank"><span class="octicon octicon-mail"></span></a>
                <a class="foot-item" href="https://github.com/wshellu" target="_blank"><span class="octicon octicon-mark-github"></span></a>
                <a class="foot-item" href="http://wshellu.github.io/feed.xml" target="_blank"><span class="octicon octicon-rss"></span></a>
                <a class="foot-item" href="http://wshellu.github.io/link/"><span class="octicon octicon-link-external"></span></a>
                &nbsp;
                <a href="http://wshellu.github.io/"><span class="word-keep">&copy; wshellu</span></a>
        </div>
    </footer>


</body>
</html>
